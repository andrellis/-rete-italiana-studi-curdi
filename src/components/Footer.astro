---
import { getCollection } from 'astro:content';

// Get site settings and navigation with error handling
let siteSettings: any[] = [];
let navigationItems: any[] = [];

try {
  siteSettings = await getCollection('settings');
} catch (error) {
  console.warn('Settings collection not found or empty:', error);
}

try {
  navigationItems = await getCollection('navigation');
} catch (error) {
  console.warn('Navigation collection not found or empty:', error);
}

// Sort navigation by order
const sortedNavigation = navigationItems.length > 0 
  ? navigationItems.sort((a, b) => a.data.order - b.data.order)
  : [];

// Get settings data with fallbacks
const settings = siteSettings.length > 0 ? siteSettings[0]?.data : null;
const siteName = settings?.logoText || 'Rete Italiana Studi Curdi';
const contactEmail = settings?.contactEmail || 'rete.italiana.studi.curdi@gmail.com';
const website = settings?.website || 'www.reteitalianastudicurdi.it';
const footerText = settings?.footerText || 'Un network di accademici, ricercatori e studenti interessati allo studio di tutti i temi attinenti agli studi curdi.';
const copyrightYear = settings?.copyrightYear || new Date().getFullYear();
---

<footer class="bg-gray-900 text-white">
  <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <!-- About Section -->
      <div>
        <h3 class="text-lg font-semibold mb-4">{siteName}</h3>
        <p class="text-gray-300 text-sm leading-relaxed">
          {footerText}
        </p>
      </div>
      
      <!-- Quick Links -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Link Utili</h3>
        <ul class="space-y-2">
          {sortedNavigation.map((item) => (
            <li>
              <a 
                href={item.data.url} 
                class="text-gray-300 hover:text-white text-sm transition-colors"
                {...(item.data.isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
              >
                {item.data.label}
              </a>
            </li>
          ))}
        </ul>
      </div>
      
      <!-- Contact Info -->
      <div>
        <h3 class="text-lg font-semibold mb-4">Contatti</h3>
        <div class="text-gray-300 text-sm space-y-2">
          <p>Email: {contactEmail}</p>
          <p>Website: {website}</p>
        </div>
      </div>
    </div>
    
    <div class="border-t border-gray-800 mt-8 pt-8 text-center">
      <p class="text-gray-400 text-sm">
        Â© {copyrightYear} {siteName}. Tutti i diritti riservati.
      </p>
    </div>
  </div>
</footer>
