---
import { getCollection } from 'astro:content';
import Logo from './Logo.astro';

// Get navigation items and site settings with error handling
let navigationItems: any[] = [];
let siteSettings: any[] = [];

try {
  navigationItems = await getCollection('navigation');
} catch (error) {
  console.warn('Navigation collection not found or empty:', error);
}

try {
  siteSettings = await getCollection('settings');
} catch (error) {
  console.warn('Settings collection not found or empty:', error);
}

// Sort navigation by order
const sortedNavigation = navigationItems.length > 0 
  ? navigationItems.sort((a, b) => a.data.order - b.data.order)
  : [];

// Get site settings with fallbacks
const settings = siteSettings.length > 0 ? siteSettings[0]?.data : null;
const siteName = settings?.logoText || 'Rete Italiana Studi Curdi';
const logoImage = settings?.logoImage;
const logoVariant = settings?.logoVariant || 'full';
const showLogoImage = settings?.showLogoImage !== false;
const showLogoText = settings?.showLogoText !== false;
const logoAlt = settings?.logoAlt || 'Rete Italiana Studi Curdi Logo';
---

<header class="bg-white shadow-sm border-b border-gray-200">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href="/" class="hover:opacity-80 transition-opacity">
          <Logo 
            variant={logoVariant}
            size="md"
            logoImage={logoImage}
            logoAlt={logoAlt}
            showLogoImage={showLogoImage}
            showLogoText={showLogoText}
            siteName={siteName}
          />
        </a>
      </div>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="ml-10 flex items-baseline space-x-4">
          {sortedNavigation
            .filter(item => item.data.showDesktop !== false)
            .map((item) => (
              <a 
                href={item.data.url} 
                class="text-gray-900 hover:text-red-600 px-3 py-2 rounded-md text-sm font-medium transition-colors"
                {...(item.data.isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
              >
                {item.data.label}
              </a>
            ))}
        </div>
      </div>
      
      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button type="button" class="text-gray-900 hover:text-red-600 focus:outline-none focus:text-red-600" aria-controls="mobile-menu" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <!-- Hamburger icon -->
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu -->
    <div class="md:hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        {sortedNavigation
          .filter(item => item.data.showMobile !== false)
          .map((item) => (
            <a 
              href={item.data.url} 
              class="text-gray-900 hover:text-red-600 block px-3 py-2 rounded-md text-base font-medium"
              {...(item.data.isExternal ? { target: "_blank", rel: "noopener noreferrer" } : {})}
            >
              {item.data.label}
            </a>
          ))}
      </div>
    </div>
  </nav>
</header>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuButton = document.querySelector('[aria-controls="mobile-menu"]');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => {
        const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
        mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
        mobileMenu.style.display = isExpanded ? 'none' : 'block';
      });
    }
  });
</script>
