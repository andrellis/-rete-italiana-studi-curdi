---
export interface Props {
  username: string;
  height?: number;
  title?: string;
}

const { username, height = 400, title = "Seguici su Facebook" } = Astro.props;
---

<div class="bg-white rounded-lg shadow-md p-6">
  <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
    <svg class="w-6 h-6 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
    </svg>
    {title}
  </h3>
  
  <!-- Facebook Page Plugin -->
  <div class="facebook-page-plugin">
    <div 
      class="fb-page" 
      data-href={`https://www.facebook.com/${username}`}
      data-tabs="timeline"
      data-width="500"
      data-height={height}
      data-small-header="false"
      data-adapt-container-width="true"
      data-hide-cover="false"
      data-show-facepile="true"
    >
      <blockquote 
        cite={`https://www.facebook.com/${username}`} 
        class="fb-xfbml-parse-ignore"
      >
        <a href={`https://www.facebook.com/${username}`}>Facebook Page</a>
      </blockquote>
    </div>
  </div>
  
  <!-- Fallback content if Facebook embed fails -->
  <div class="facebook-fallback hidden">
    <p class="text-gray-600 text-sm mb-4">
      Segui i nostri aggiornamenti su Facebook per rimanere informato sui nostri eventi e pubblicazioni.
    </p>
    <a 
      href={`https://www.facebook.com/${username}`} 
      target="_blank" 
      rel="noopener noreferrer"
      class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
    >
      <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
      Seguici su Facebook
    </a>
  </div>
</div>

<!-- Facebook SDK -->
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/it_IT/sdk.js#xfbml=1&version=v18.0"></script>

<script>
  // Fallback handling
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
      const facebookContainer = document.querySelector('.facebook-page-plugin') as HTMLElement;
      const fallback = document.querySelector('.facebook-fallback') as HTMLElement;
      
      if (facebookContainer && fallback) {
        // If no content is loaded after 5 seconds, show fallback
        setTimeout(function() {
          const fbPage = facebookContainer.querySelector('.fb-page') as HTMLElement;
          if (!fbPage || fbPage.offsetHeight === 0) {
            facebookContainer.style.display = 'none';
            fallback.classList.remove('hidden');
          }
        }, 5000);
      }
    }, 1000);
  });
</script>

<style>
  .facebook-page-plugin {
    min-height: 400px;
  }
  
  .facebook-fallback {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
    text-align: center;
  }
  
  /* Custom styling for Facebook embed */
  .fb-page {
    border-radius: 0.5rem;
    overflow: hidden;
  }
</style>
